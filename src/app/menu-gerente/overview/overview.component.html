<!-- ============================================================================
     TELA GERENCIAL DO CARD√ÅPIO - Componente Overview
     Exibe tabela de itens, permite filtrar, adicionar, editar e remover itens
     ============================================================================ -->
<div class="tela-gerente-container">
  
  <!-- SE√á√ÉO CABE√áALHO - Contagem de itens e bot√£o para adicionar -->
  <header class="top-header">
    <div class="header-content">
      <!-- Caixa com contagem de itens no card√°pio -->
      <div class="overview-box">
        <h3 class="box-title">Items no card√°pio</h3>
        <div class="box-count">{{ menuItems.length }} <span>üìä</span></div>
      </div>
      <!-- Bot√£o para abrir modal de adi√ß√£o de novo item -->
      <button class="btn-add" (click)="openAddItemModal()">
        + Adicionar Item
      </button>
    </div>
  </header>

  <!-- SE√á√ÉO CORPO PRINCIPAL - Filtros, busca e tabela de itens -->
  <div class="content-body">
    <h2 class="section-title">Itens Adicionados</h2>

    <!-- BARRA DE FILTROS - Busca por nome e bot√µes de categoria -->
    <div class="filter-bar">
      <!-- Campo de busca: usu√°rio digita para filtrar por nome ou categoria -->
      <input
        type="text"
        placeholder="üîç Busque pelo Item"
        [(ngModel)]="searchTerm"
        (input)="applyCombinedFilter()"
        class="search-input">
      
      <!-- Bot√µes de filtro por categoria - Loop que cria um bot√£o para cada categoria -->
      <!-- Quando clica no bot√£o, chama applyCategoryFilter com a categoria selecionada -->
      <!-- Bot√£o fica destacado (active) quando a categoria √© a selecionada -->
      <button
        *ngFor="let category of allCategories"
        class="filter-btn-categoria"
        (click)="applyCategoryFilter(category)"
        [class.active]="selectedCategory === category">
        {{ category }}
      </button>
    </div>

    <!-- TABELA DE ITENS - Exibe todos os itens (ou filtrados) em forma de tabela -->
    <table class="menu-table">
      <!-- Cabe√ßalho da tabela - T√≠tulos das colunas -->
      <thead>
        <tr>
          <th>Foto</th>
          <th>Nome</th>
          <th>Pre√ßo</th>
          <th>Categoria</th>
          <th>A√ß√µes</th>
        </tr>
      </thead>
      <!-- Corpo da tabela - Loop que exibe cada item filtrado -->
      <tbody>
        <!-- Loop: renderiza uma linha para cada item em filteredItems -->
        <!-- filteredItems √© o array com os itens ap√≥s aplicar filtros -->
        <tr *ngFor="let item of filteredItems">
          <!-- Coluna FOTO: Imagem do item, ou placeholder se n√£o tiver -->
          <td><img [src]="item.UrlImage || 'placeholder.jpg'" alt="{{ item.nome }}" class="item-foto"></td>
          
          <!-- Coluna NOME: Nome do item + tag adicional -->
          <td>{{ item.nome }} <span class="item-tag">{{ item.tag }}</span></td>
          
          <!-- Coluna PRE√áO: Pre√ßo formatado -->
          <td>{{ item.preco }}</td>
          
          <!-- Coluna CATEGORIA: Badge colorido com a categoria -->
          <!-- Classe din√¢mica muda a cor baseado na categoria do item -->
          <td>
            <span
              class="category-pill"
              [ngClass]="'category-' + item.categoria">
              {{ item.categoria }}
            </span>
          </td>
          
          <!-- Coluna A√á√ïES: √çcones para editar e remover -->
          <!-- popup-parent: container para posicionar o popup de confirma√ß√£o -->
          <td class="action-icons popup-parent">
            <div class="action-icons-inner">
              <!-- √çcone de editar (l√°pis) - Clica para abrir modal de edi√ß√£o -->
              <span class="icon-edit" (click)="openEditItem(item)">‚úèÔ∏è</span>

              <!-- √çcone de remover (lixo) - Clica para pedir confirma√ß√£o de remo√ß√£o -->
              <span class="icon-remove" (click)="openRemoveConfirm(item)">üóëÔ∏è</span>
            </div>

            <!-- Popup de confirma√ß√£o de remo√ß√£o -->
            <!-- Aparece apenas quando isRemovePopupOpen=true E o item selecionado √© este item -->
            <!-- Emite evento close quando quer fechar, ou confirmRemove quando confirma remo√ß√£o -->
            <app-remove-popup
              *ngIf="isRemovePopupOpen && selectedItem === item"
              [itemName]="selectedItem.nome"
              (close)="closeModal()"
              (confirmRemove)="onRemoveConfirmed()">
            </app-remove-popup>
          </td>
        </tr>
      </tbody>
    </table>
    
    <!-- RODAP√â DA TABELA - Mostra quantos itens est√£o sendo exibidos -->
    <!-- "Exibindo 2 de 4 Itens" = 2 itens ap√≥s filtrar, de um total de 4 -->
    <div class="items-footer">
      Exibindo {{ filteredItems.length }} de {{ menuItems.length }} Itens
    </div>
  </div>
</div>

<!-- ============================================================================
     SE√á√ÉO DE MODAIS - Componentes que aparecem sobre a tela principal
     Os modais ficam aqui embaixo e s√£o mostrados/escondidos via *ngIf
     ============================================================================ -->

<!-- MODAL 1: ADICIONAR ITEM -->
<!-- Overlay (fundo escuro) que fecha o modal ao clicar -->
<!-- Modal s√≥ aparece quando isAddItemModalOpen = true -->
<div class="modal-overlay"
  *ngIf="isAddItemModalOpen"
  (click)="closeModal()">
  <!-- Componente do modal de adi√ß√£o -->
  <!-- Emite evento close quando quer fechar, ou itemAdded quando adiciona um novo item -->
  <!-- stopPropagation evita que clicar no modal feche ele -->
  <app-add-item-modal
    (close)="closeModal()"
    (itemAdded)="onItemAdded($event)"
    (click)="$event.stopPropagation()"
    [ngClass]="isAddItemModalOpen ? 'side-panel-enter' : 'side-panel-exit'">
  </app-add-item-modal>
</div>

<!-- MODAL 2: EDITAR ITEM -->
<!-- Similar ao modal de adicionar, mas passa o item selecionado para o modal -->
<!-- Modal s√≥ aparece quando isEditItemModalOpen = true E um item est√° selecionado -->
<div class="modal-overlay"
  *ngIf="isEditItemModalOpen && selectedItem"
  (click)="closeModal()">
  <!-- Componente do modal de edi√ß√£o -->
  <!-- [item] passa o item selecionado para o modal editar -->
  <!-- Emite evento close quando quer fechar, ou itemUpdated quando edita o item -->
  <app-edit-item-modal
    [item]="selectedItem"
    (close)="closeModal()"
    (itemUpdated)="onItemUpdated($event)"
    (click)="$event.stopPropagation()"
    [ngClass]="isEditItemModalOpen ? 'side-panel-enter' : 'side-panel-exit'">
  </app-edit-item-modal>
</div>
