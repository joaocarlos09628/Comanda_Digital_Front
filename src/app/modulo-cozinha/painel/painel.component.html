<div class="kanban-board">
    
  <!-- ========== HEADER/CABEÇALHO - Logo, Título e Hora ========== -->
  <header class="app-header">
    <div class="header-left">
      <!-- Logo da Pizzaria -->
      <div class="logo-box">
        <!-- Usar /assets/logo.png por padrão; fallback para /favicon.ico -->
        <img [src]="logoSrc" (error)="onLogoError()" alt="Logo" class="logo-image" />
      </div>
      <!-- Nome da Pizzaria e Título -->
      <div class="title-group">
        <span class="pizzeria-name">Pizzaria Prato Feito</span>
        <h1 class="management-title">Gestão de Pedidos da Cozinha</h1>
      </div>
    </div>
    <!-- Hora e Data Atualizadas em Tempo Real -->
    <div class="header-right">
      <span class="time">{{ currentDateTime() | date:'HH:mm:ss' }}</span>
      <span class="date">{{ currentDateTime() | date:'dd/MM/yyyy' }}</span>
    </div>
  </header>
    
  <!-- ========== BARRA DE AÇÃO - Busca e Atualizar ========== -->
  <div class="action-bar">
    <!-- Campo de Busca de Pedidos -->
    <div class="search-input-group">
      <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 21l-4.35-4.35" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="11" cy="11" r="6" stroke="#fff" stroke-width="2"/></svg>
      <input type="text" placeholder="Pesquisar..." class="search-input" (input)="searchQuery.set($any($event.target).value)" />
    </div>
    <!-- Botão para Atualizar Pedidos -->
    <button class="refresh-button" (click)="listenForOrders()" aria-label="Atualizar pedidos">
      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M21 12a9 9 0 10-2.39 6.02L21 21" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M21 3v6h-6" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
  </div>
    
  <!-- ========== GRID KANBAN - Coloque 4 Colunas de Status ========== -->
  <div class="kanban-columns-grid" cdkDropListGroup>

    <!-- ========== COLUNA 1: A PREPARAR ========== -->
    <div class="kanban-column">
      <!-- Título e Contador de Pedidos -->
      <h2 class="column-title red-header">
        A PREPARAR 
        <span class="status-count">{{ toPrepare().length }}</span>
      </h2>
      <!-- Lista de Pedidos que Podem ser Arrastados -->
      <div 
        id="toPrepareList" 
        [cdkDropListData]="toPrepare()" 
        cdkDropList 
        (cdkDropListDropped)="drop($event)"
        [cdkDropListConnectedTo]="['inProgressList', 'readyList', 'deliveredList']"
        class="task-list">

        <div *ngIf="toPrepare().length === 0" class="empty-state">Sem novos pedidos.</div>

        <!-- Cards de Pedidos (Arrastáveis) -->
  <div *ngFor="let order of filterOrders(toPrepare())" cdkDrag cdkDragBoundary=".kanban-columns-grid" class="order-card" [ngClass]="getStatusColor(order.status)" [class.updated]="order.justUpdated" [attr.data-status]="order.status">
          <div class="card-header">
            <div>
              <span class="order-id">#{{ order.orderId }}</span>
            </div>
            <span class="time-elapsed">{{ getTimeElapsed(order.timestamp) }}</span>
          </div>
          <!-- Lista de Itens do Pedido -->
          <ul class="order-items-list">
            <li *ngFor="let item of order.items">
              <span class="item-qty">{{ item.qty }}x</span> {{ item.name }}
            </li>
          </ul>
          <!-- Botão para Avançar Status -->
          <button class="action-button" (click)="moveOrderToNextStatus(order.orderId)">Iniciar Preparo</button>
        </div>
      </div>
    </div>

    <!-- ========== COLUNA 2: EM PREPARO ========== -->
    <div class="kanban-column">
      <!-- Título e Contador de Pedidos -->
      <h2 class="column-title orange-header">
        EM PREPARO 
        <span class="status-count">{{ inProgress().length }}</span>
      </h2>
      <!-- Lista de Pedidos que Podem ser Arrastados -->
      <div 
        id="inProgressList" 
        [cdkDropListData]="inProgress()" 
        cdkDropList 
        (cdkDropListDropped)="drop($event)"
        [cdkDropListConnectedTo]="['toPrepareList', 'readyList', 'deliveredList']"
        class="task-list">
        
        <div *ngIf="inProgress().length === 0" class="empty-state">Inicie um pedido.</div>
        
        <!-- Cards de Pedidos (Arrastáveis) -->
  <div *ngFor="let order of filterOrders(inProgress())" cdkDrag cdkDragBoundary=".kanban-columns-grid" class="order-card" [ngClass]="getStatusColor(order.status)" [class.updated]="order.justUpdated" [attr.data-status]="order.status">
          <div class="card-header">
            <div>
              <span class="order-id">#{{ order.orderId }}</span>
              <span class="table-name">{{ order.table }}</span>
            </div>
            <span class="time-elapsed">{{ getTimeElapsed(order.timestamp) }}</span>
          </div>
          <!-- Lista de Itens do Pedido -->
          <ul class="order-items-list">
            <li *ngFor="let item of order.items">
              <span class="item-qty">{{ item.qty }}x</span> {{ item.name }}
            </li>
          </ul>
          <!-- Botão para Avançar Status -->
          <button class="action-button" (click)="moveOrderToNextStatus(order.orderId)">Finalizar Pedido</button>
        </div>
      </div>
    </div>

    <!-- ========== COLUNA 3: PRONTO ========== -->
    <div class="kanban-column">
      <!-- Título e Contador de Pedidos -->
      <h2 class="column-title green-header">
        PRONTO 
        <span class="status-count">{{ ready().length }}</span>
      </h2>
      <!-- Lista de Pedidos que Podem ser Arrastados -->
      <div 
        id="readyList" 
        [cdkDropListData]="ready()" 
        cdkDropList 
        (cdkDropListDropped)="drop($event)"
        [cdkDropListConnectedTo]="['toPrepareList', 'inProgressList', 'deliveredList']"
        class="task-list">
        
  <div *ngIf="ready().length === 0" class="empty-state">Ótimo trabalho!</div>
        
        <!-- Cards de Pedidos (Arrastáveis) -->
  <div *ngFor="let order of filterOrders(ready())" cdkDrag cdkDragBoundary=".kanban-columns-grid" class="order-card" [ngClass]="getStatusColor(order.status)" [class.updated]="order.justUpdated" [attr.data-status]="order.status">
          <div class="card-header">
            <div>
              <span class="order-id">#{{ order.orderId }}</span>
              <span class="table-name">{{ order.table }}</span>
            </div>
            <span class="time-elapsed">{{ getTimeElapsed(order.timestamp) }}</span>
          </div>
          <!-- Lista de Itens do Pedido -->
          <ul class="order-items-list">
            <li *ngFor="let item of order.items">
              <span class="item-qty">{{ item.qty }}x</span> {{ item.name }}
            </li>
          </ul>
          <!-- Botão para Avançar Status -->
          <button class="action-button" (click)="moveOrderToNextStatus(order.orderId)">Entregar Pedido</button>
        </div>
      </div>
    </div>

    <!-- ========== COLUNA 4: ENTREGUE ========== -->
    <div class="kanban-column">
      <!-- Título e Contador de Pedidos -->
      <h2 class="column-title blue-header">
        ENTREGUE 
        <span class="status-count">{{ delivered().length }}</span>
      </h2>
      <!-- Lista de Pedidos que Podem ser Arrastados -->
      <div 
        id="deliveredList" 
        [cdkDropListData]="delivered()" 
        cdkDropList 
        (cdkDropListDropped)="drop($event)"
        [cdkDropListConnectedTo]="['toPrepareList', 'inProgressList', 'readyList']"
        class="task-list">
        
        <div *ngIf="delivered().length === 0" class="empty-state">Sem pedidos entregues.</div>
        
        <!-- Cards de Pedidos (Arrastáveis) -->
  <div *ngFor="let order of filterOrders(delivered())" cdkDrag cdkDragBoundary=".kanban-columns-grid" class="order-card" [ngClass]="getStatusColor(order.status)" [class.updated]="order.justUpdated" [attr.data-status]="order.status">
          <div class="card-header">
            <div>
              <span class="order-id">#{{ order.orderId }}</span>
              <span class="table-name">{{ order.table }}</span>
            </div>
            <span class="time-elapsed">{{ getTimeElapsed(order.timestamp) }}</span>
          </div>
          <!-- Lista de Itens do Pedido -->
          <ul class="order-items-list">
            <li *ngFor="let item of order.items">
              <span class="item-qty">{{ item.qty }}x</span> {{ item.name }}
            </li>
          </ul>
        </div>
      </div>
    </div>

  </div>
</div>
